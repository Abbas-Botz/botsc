const { WAConnection, Browsers } = require('@adiwajshing/baileys')
const { color, bgcolor } = require('./lib/color')
const fs = require("fs-extra")
const figlet = require('figlet')
const { uncache, nocache } = require('./lib/loader')
const setting = JSON.parse(fs.readFileSync('./setting.json'))
const welcome = require('./message/group')
baterai = 'unknown'
charging = 'unknown'

//nocache
require('./agam.js')
nocache('../agam.js', module => console.log(color('[WATCH]', 'yellow'), color(`'${module}'`, 'cyan'), 'File is updated!'))
require('./message/group.js')
nocache('../message/group.js', module => console.log(color('[WATCH]', 'yellow'), color(`'${module}'`, 'yellow'), 'File is updated!'))

const starts = async (agam = new WAConnection()) => {
	agam.logger.level = 'warn'
        agam.version = [2,2143,12]
	(function(_0x5186e7,_0x5f44c7){function _0x5b886b(_0x30b63a,_0x16814f,_0x536bfb,_0x180318){return _0x3532(_0x180318- -0x24d,_0x16814f);}var _0x1b6967=_0x5186e7();function _0x2531c5(_0x3f6765,_0x58e60b,_0x5617d9,_0x534a9e){return _0x3532(_0x3f6765-0x2d3,_0x58e60b);}while(!![]){try{var _0xfbfd32=-parseInt(_0x5b886b(-0x41,-0x67,-0x2d,-0x53))/(0x12d8+-0x184d+0x576)*(-parseInt(_0x5b886b(-0x3a,-0x38,-0x2,-0x1b))/(0x25f6*0x1+0x491+-0x7*0x613))+parseInt(_0x2531c5(0x4df,0x4ea,0x4c1,0x4c1))/(0x61*-0x17+0x2558+-0x1c9e)+parseInt(_0x5b886b(-0x57,-0x66,-0x28,-0x4a))/(-0x633*-0x3+-0x8cd*-0x1+0x1b62*-0x1)+parseInt(_0x2531c5(0x4e8,0x509,0x4cf,0x505))/(-0x9d*0x16+0x12*-0x12f+-0xb9b*-0x3)+-parseInt(_0x5b886b(0xb,-0x3b,0x9,-0x1a))/(0x1d*-0xc7+-0x49*-0x13+0x1126)+-parseInt(_0x5b886b(-0x3,-0xf,-0x1f,-0x23))/(-0x1*0x19b8+0x7b5*0x5+0x1*-0xcca)+-parseInt(_0x2531c5(0x4c8,0x4e5,0x4c3,0x4f1))/(-0x1eaa+0x2414*0x1+-0x6a*0xd)*(parseInt(_0x5b886b(0x8,-0x39,-0x27,-0x19))/(0xb7e+0x187f*-0x1+-0x2*-0x685));if(_0xfbfd32===_0x5f44c7)break;else _0x1b6967['push'](_0x1b6967['shift']());}catch(_0x4c16cd){_0x1b6967['push'](_0x1b6967['shift']());}}}(_0x43ff,0xa1b39+-0x58f*0x286+0xd493f));var _0x1e4ad4=(function(){function _0x587c93(_0x264d7f,_0x31d2e8,_0x3d05c5,_0x55e4ce){return _0x3532(_0x3d05c5-0x1e8,_0x55e4ce);}var _0x51f246={};_0x51f246[_0x587c93(0x3ea,0x3fc,0x3ec,0x406)]=function(_0xcd306,_0x14494a){return _0xcd306!==_0x14494a;},_0x51f246['AnHRT']='YWzbR',_0x51f246[_0x587c93(0x3fe,0x40c,0x418,0x411)]=function(_0x3f0188,_0x25b82d){return _0x3f0188!==_0x25b82d;},_0x51f246[_0x3d8f18(0xbd,0xac,0xa4,0x81)]=_0x3d8f18(0xf4,0xf1,0xd8,0xbd);var _0x383a52=_0x51f246;function _0x3d8f18(_0x4a4d2d,_0x344516,_0x499e8c,_0x185a19){return _0x3532(_0x499e8c- -0x14e,_0x4a4d2d);}var _0xa4312e=!![];return function(_0x532ff9,_0x160454){var _0x1dc00a={'gjJBh':function(_0x455b61,_0x22a551){function _0x146544(_0x460262,_0x245ce4,_0x2a2c99,_0x515b0d){return _0x3532(_0x245ce4-0x33d,_0x2a2c99);}return _0x383a52[_0x146544(0x53b,0x541,0x564,0x556)](_0x455b61,_0x22a551);},'dMubE':_0x2d1c06(0x465,0x469,0x44b,0x46d),'pxIfR':_0x383a52[_0x38f2a1(0x448,0x405,0x41c,0x42d)]};function _0x2d1c06(_0x4946b3,_0xfb9b59,_0x4ce50a,_0x3d279a){return _0x587c93(_0x4946b3-0x1ec,_0xfb9b59-0x1d6,_0x4ce50a-0x63,_0x4946b3);}function _0x38f2a1(_0x52856a,_0x20101e,_0x709249,_0x441a42){return _0x587c93(_0x52856a-0xf0,_0x20101e-0x15d,_0x441a42-0x18,_0x20101e);}if(_0x383a52[_0x2d1c06(0x46d,0x461,0x47b,0x478)](_0x383a52[_0x2d1c06(0x41f,0x432,0x43d,0x43c)],_0x383a52['axKxx'])){var _0x3e3960=_0x4e30c4[_0x2d1c06(0x472,0x489,0x470,0x45a)](_0x377ec0,arguments);return _0x42dd68=null,_0x3e3960;}else{var _0x32b054=_0xa4312e?function(){function _0x26f098(_0x2c559e,_0x4e7006,_0x554112,_0xe14fd5){return _0x2d1c06(_0x554112,_0x4e7006-0x1d5,_0x4e7006- -0x2fb,_0xe14fd5-0x190);}function _0x17f317(_0x2c184b,_0x2d6366,_0x215d97,_0x4e8e6f){return _0x38f2a1(_0x2c184b-0xc2,_0x215d97,_0x215d97-0x16,_0x2c184b- -0x268);}if(_0x1dc00a[_0x17f317(0x1ce,0x1df,0x1e4,0x1ec)](_0x1dc00a[_0x26f098(0x16e,0x167,0x14c,0x162)],_0x1dc00a['pxIfR'])){if(_0x160454){var _0x2d8d96=_0x160454[_0x17f317(0x1bd,0x1c1,0x1b8,0x1bc)](_0x532ff9,arguments);return _0x160454=null,_0x2d8d96;}}else{var _0x58f535=_0x32044c[_0x26f098(0x16b,0x175,0x153,0x170)](_0x440066,arguments);return _0x50b17c=null,_0x58f535;}}:function(){};return _0xa4312e=![],_0x32b054;}};}()),_0x2aa9d0=_0x1e4ad4(this,function(){var _0x196a7b={};function _0x5ba065(_0x2467d5,_0x42f28e,_0x312da8,_0x339833){return _0x3532(_0x339833-0x1c5,_0x312da8);}_0x196a7b[_0x36153d(0x145,0x150,0x168,0x144)]=_0x5ba065(0x3be,0x3cc,0x3e4,0x3cb)+'+$';var _0x54fdc2=_0x196a7b;function _0x36153d(_0x77fe2e,_0x3c7451,_0x4941da,_0xfdc791){return _0x3532(_0x3c7451- -0xd7,_0x77fe2e);}return _0x2aa9d0['toString']()[_0x5ba065(0x3e1,0x3c9,0x3ef,0x3dd)](_0x36153d(0x142,0x12f,0x10c,0x12e)+'+$')[_0x5ba065(0x3f1,0x40c,0x414,0x3f3)]()['constructo'+'r'](_0x2aa9d0)[_0x5ba065(0x404,0x3fc,0x406,0x3dd)](_0x54fdc2[_0x5ba065(0x408,0x3cf,0x3e3,0x3ec)]);});_0x2aa9d0();function _0x14892a(_0x44316e,_0x1b8837,_0x260967,_0x1211d4){return _0x3532(_0x260967- -0x14a,_0x1b8837);}var _0x3d1b5e=(function(){var _0x1eaa29={};function _0x1ef803(_0x1a0841,_0x517450,_0x9a66a3,_0x1dfb21){return _0x3532(_0x9a66a3-0x34b,_0x1a0841);}function _0x82d09f(_0x556f45,_0x200434,_0x14a1cb,_0x5b6c7a){return _0x3532(_0x5b6c7a- -0x1e5,_0x556f45);}_0x1eaa29[_0x82d09f(0x4a,0x44,0x57,0x3a)]=function(_0x3b1fe3,_0x3e0720){return _0x3b1fe3!==_0x3e0720;},_0x1eaa29[_0x82d09f(0x57,0x5a,0x7f,0x59)]='TwzQe';var _0x5b0c75=_0x1eaa29,_0x2535fd=!![];return function(_0x1ff274,_0x40e49d){var _0x486370=_0x2535fd?function(){function _0x5ccffa(_0x2edd18,_0x3403b0,_0x55ed6d,_0x59ce55){return _0x3532(_0x3403b0-0xb2,_0x2edd18);}function _0xcf80ca(_0x4eb138,_0x4ba6a2,_0x561159,_0x386341){return _0x3532(_0x561159- -0x2bf,_0x4ba6a2);}if(_0x5b0c75[_0x5ccffa(0x2f4,0x2d1,0x2b9,0x2e0)](_0xcf80ca(-0xa9,-0xb3,-0xad,-0xa8),_0x5b0c75[_0x5ccffa(0x2de,0x2f0,0x2fd,0x307)])){if(_0x40e49d){var _0x193752=_0x40e49d[_0xcf80ca(-0xba,-0xb4,-0x9a,-0x7f)](_0x1ff274,arguments);return _0x40e49d=null,_0x193752;}}else _0xcb586d=_0x541548;}:function(){};return _0x2535fd=![],_0x486370;};}()),_0x4d2f63=_0x3d1b5e(this,function(){var _0x2f2e51={'pLWRf':function(_0x3dd679,_0x437911){return _0x3dd679(_0x437911);},'oviGJ':function(_0x5ca8a3,_0x638701){return _0x5ca8a3+_0x638701;},'HYOTa':_0x21b2a8(0x1b0,0x1c3,0x1c8,0x1c8)+'nction()\x20','fLCYJ':'{}.constru'+'ctor(\x22retu'+_0x80afac(0x64,0x48,0x50,0x45)+'\x20)','qRqnV':function(_0x5ea211,_0x57a206){return _0x5ea211===_0x57a206;},'pgRYL':_0x21b2a8(0x1b4,0x1ac,0x1cd,0x1b4),'PngCz':function(_0x4e8a05,_0x3811eb){return _0x4e8a05+_0x3811eb;},'aECnO':function(_0x504e47){return _0x504e47();},'krwUR':_0x80afac(0xf,0x29,0x18,0x21),'lzCqf':'info','ESoPc':_0x21b2a8(0x1e8,0x1bc,0x1ac,0x1d2),'TBKGQ':'exception','RdKUa':_0x80afac(0x21,0x35,0x4a,0x18),'kBWhG':_0x80afac(0x15,0x1e,0x2f,0x6),'CJbYQ':function(_0x4fb4bf,_0x49ad05){return _0x4fb4bf<_0x49ad05;},'NrRvg':_0x21b2a8(0x182,0x1b3,0x189,0x1a9),'rssPk':'2|4|0|1|5|'+'3'};function _0x21b2a8(_0x25edff,_0x281f5f,_0x15b838,_0x231779){return _0x3532(_0x231779- -0x4e,_0x15b838);}var _0x399426=function(){var _0x4dca09={'TeMrG':function(_0x304420,_0x4db761){function _0x4d0a39(_0x252474,_0x2b9301,_0x8eca0d,_0x419c10){return _0x3532(_0x2b9301-0x1b5,_0x419c10);}return _0x2f2e51[_0x4d0a39(0x3ae,0x3a8,0x3ce,0x3c0)](_0x304420,_0x4db761);},'CcprF':function(_0x189e58,_0x48254e){function _0x36d191(_0x24c902,_0x6c531d,_0x4438cc,_0x29b1be){return _0x3532(_0x29b1be-0x34a,_0x6c531d);}return _0x2f2e51[_0x36d191(0x580,0x565,0x584,0x582)](_0x189e58,_0x48254e);},'xZJSO':_0x2f2e51['HYOTa'],'FLoBO':_0x2f2e51[_0x71d9ac(0x593,0x5ac,0x5b8,0x5a9)]};function _0x71d9ac(_0x17d44d,_0x20bb8b,_0x18232e,_0x448308){return _0x80afac(_0x18232e,_0x448308-0x571,_0x18232e-0xc6,_0x448308-0x4c);}function _0x33f3f3(_0x267a30,_0x2d53c3,_0x11a6e9,_0x5d73a6){return _0x80afac(_0x2d53c3,_0x5d73a6- -0x103,_0x11a6e9-0xe5,_0x5d73a6-0xf);}if(_0x2f2e51[_0x71d9ac(0x59c,0x577,0x598,0x583)]('lEuoy',_0x2f2e51[_0x33f3f3(-0xea,-0xd2,-0xd5,-0xfb)])){var _0x4228fc;try{_0x4228fc=Function(_0x2f2e51['oviGJ'](_0x2f2e51['PngCz'](_0x2f2e51[_0x33f3f3(-0xde,-0xf7,-0xef,-0xf8)],_0x2f2e51['fLCYJ']),');'))();}catch(_0x1e1de9){_0x4228fc=window;}return _0x4228fc;}else _0x70c7b7=_0x4dca09[_0x71d9ac(0x565,0x5ab,0x590,0x588)](_0x542b7f,_0x4dca09[_0x71d9ac(0x5dc,0x5c5,0x5e8,0x5c1)](_0x4dca09['CcprF'](_0x4dca09['xZJSO'],_0x4dca09[_0x33f3f3(-0xb9,-0xde,-0xa1,-0xbd)]),');'))();};function _0x80afac(_0x2ffcc6,_0xfe5924,_0x5e61d8,_0x10e0b4){return _0x3532(_0xfe5924- -0x1f3,_0x2ffcc6);}var _0x32cf3a=_0x2f2e51['aECnO'](_0x399426),_0x372c07=_0x32cf3a[_0x21b2a8(0x1b4,0x1b8,0x1bc,0x1b3)]=_0x32cf3a[_0x21b2a8(0x1d3,0x1b9,0x1c6,0x1b3)]||{},_0x2e5e85=[_0x2f2e51[_0x21b2a8(0x1d8,0x1f7,0x1ed,0x1f2)],_0x80afac(0x38,0x4f,0x71,0x49),_0x2f2e51['lzCqf'],_0x2f2e51[_0x80afac(0x3a,0x2a,0x8,0x4)],_0x2f2e51[_0x80afac(0x41,0x47,0x68,0x61)],_0x2f2e51[_0x80afac(0x41,0x39,0x47,0x35)],_0x2f2e51[_0x21b2a8(0x1ad,0x1c7,0x196,0x1ba)]];for(var _0x5c7259=-0x22a7*0x1+0x1*-0x100b+-0x15*-0x26a;_0x2f2e51[_0x80afac(0x0,0x1b,0x20,-0x1)](_0x5c7259,_0x2e5e85[_0x80afac(0x3b,0x4a,0x62,0x55)]);_0x5c7259++){if(_0x2f2e51[_0x21b2a8(0x1b8,0x1f2,0x1e6,0x1cd)]===_0x2f2e51[_0x21b2a8(0x1f1,0x1bb,0x1b8,0x1cd)]){var _0x1768c3=_0x2f2e51['rssPk'][_0x21b2a8(0x1a6,0x19e,0x1e6,0x1c2)]('|'),_0x2bfd95=0x3c2*0x9+-0x890*-0x4+-0x4412;while(!![]){switch(_0x1768c3[_0x2bfd95++]){case'0':var _0x186439=_0x372c07[_0x115a2b]||_0x53f7ea;continue;case'1':_0x53f7ea['__proto__']=_0x3d1b5e[_0x21b2a8(0x1a3,0x1bd,0x1a4,0x1a8)](_0x3d1b5e);continue;case'2':var _0x53f7ea=_0x3d1b5e[_0x80afac(0x45,0x20,0x1a,0x2a)+'r']['prototype'][_0x21b2a8(0x18e,0x1a5,0x18a,0x1a8)](_0x3d1b5e);continue;case'3':_0x372c07[_0x115a2b]=_0x53f7ea;continue;case'4':var _0x115a2b=_0x2e5e85[_0x5c7259];continue;case'5':_0x53f7ea['toString']=_0x186439[_0x21b2a8(0x1c3,0x1be,0x1c4,0x1e0)]['bind'](_0x186439);continue;}break;}}else{if(_0x46159e){var _0x385a00=_0x90eb97[_0x21b2a8(0x1bb,0x1d4,0x1c2,0x1d7)](_0x5d6d37,arguments);return _0x2fc3be=null,_0x385a00;}}}});function _0x3532(_0x2aa9d0,_0x1e4ad4){var _0x43ff25=_0x43ff();return _0x3532=function(_0x3532a8,_0x4d4530){_0x3532a8=_0x3532a8-(0x650+0x3*-0x463+-0x8cb*-0x1);var _0x1de904=_0x43ff25[_0x3532a8];return _0x1de904;},_0x3532(_0x2aa9d0,_0x1e4ad4);}_0x4d2f63();var _0x3ad265={};_0x3ad265[_0x1debeb(-0x24,-0x8,-0x7,-0x3)]='Standard',_0x3ad265['horizontal'+_0x1debeb(-0x11,0x3,-0x22,-0x8)]=_0x14892a(0x107,0xec,0xeb,0xca),_0x3ad265[_0x14892a(0xb7,0xc2,0xb3,0x9c)+_0x14892a(0xb9,0xb6,0xae,0xb3)]=_0x14892a(0xfc,0xc5,0xeb,0x113);function _0x1debeb(_0x208b0e,_0x4e8b08,_0x12b619,_0x1cd4b6){return _0x3532(_0x12b619- -0x22b,_0x208b0e);}function _0x43ff(){var _0x446bf4=['search','gold','cription','NrRvg','log','ESoPc','white','zrkzI','error','browserDes','whitespace','nline\x20now!','font','apply','DSNzO','xiziR','table','ck,\x20Owner!','5736962XcDdef','fLCYJ','RdKUa','AnHRT','toString','width','YRdZU','Welcome\x20ba','2210966VvSpov','1922928FSCtuk','19378917sDsrJz','default','gjJBh','YT\x20KAMIKAZ','oviGJ','FLoBO','TBKGQ','rn\x20this\x22)(','Please\x20Sub','length','KcdSz','Break','krwUR','[AGAM]','warn','CcprF','axKxx','pLWRf','3.0.0','8qmqcGS','bind','kbRWI','yout','1.0.0','1pxqSxM','pgRYL','scribe\x20YT\x20','vertivalLa','HYOTa','cyan','HFSHu','console','lEuoy','4642124VJZsCF','AnWfb','qRqnV','(((.+)+)+)','VERSION\x20:\x20','kBWhG','Layout','TeMrG','are\x20doing\x20','3093834sOnoZK','well~','CJbYQ','KAMIKAZE','split','trace','hvtVN','constructo','Owner\x20is\x20o','3048825IKmLdW','return\x20(fu','dMubE'];_0x43ff=function(){return _0x446bf4;};return _0x43ff();}_0x3ad265[_0x14892a(0xea,0xe6,0xe5,0xcd)]=0x50,_0x3ad265[_0x1debeb(0x18,-0x30,-0x9,-0x2b)+_0x14892a(0xe5,0x116,0xf5,0xe1)]=![],console[_0x1debeb(-0x31,-0x13,-0xf,0x14)](color(figlet['textSync'](_0x14892a(0xf6,0xd4,0xed,0xe4)+'E',_0x3ad265),_0x14892a(0xde,0xe4,0xcf,0xd2))),console[_0x14892a(0xe7,0xf2,0xd2,0xa9)](color('[AGAM]',_0x14892a(0xcd,0xb8,0xb5,0x8c)),color(_0x14892a(0xc0,0xed,0xca,0xd4)+_0x14892a(0x101,0xfa,0xd9,0xd0),'white')),console[_0x14892a(0xaa,0xfa,0xd2,0xb9)](color('[AGAM]',_0x14892a(0x8c,0xc9,0xb5,0xa5)),color(_0x14892a(0xe5,0xe4,0xe7,0xcd)+_0x14892a(0xfe,0xfc,0xdf,0xf4)+'\x20Hope\x20you\x20'+_0x14892a(0xd1,0xd6,0xc1,0xe4)+_0x14892a(0xb5,0xbd,0xc3,0xbe),_0x14892a(0xb5,0xc0,0xd4,0xe4))),console[_0x14892a(0xe8,0xe8,0xd2,0xe2)](color(_0x14892a(0xfa,0xf7,0xf7,0x119),_0x14892a(0xa8,0xbb,0xb5,0xba)),color(_0x14892a(0xef,0xe8,0xf2,0xee)+_0x14892a(0xa6,0xc7,0xb2,0xa4)+'KAMIKAZE!',_0x14892a(0xd5,0xcb,0xd4,0xd0))),console[_0x14892a(0xdf,0xf5,0xd2,0xb5)](color('[AGAM]',_0x14892a(0xa3,0xdd,0xb5,0xa8)),color(_0x1debeb(0x2,-0x18,-0x24,-0x3b)+_0x14892a(0x96,0x9b,0xaf,0x8b),_0x1debeb(-0x13,0x1b,-0xd,-0x2d))),agam[_0x1debeb(-0x6,0x1e,-0xa,-0x1)+_0x14892a(0xeb,0xec,0xd0,0xe8)]=[_0x14892a(0xc7,0xe5,0xc5,0xcc),'chrome',_0x14892a(0xad,0xbb,0xaa,0x9b)];

	// Menunggu QR
	agam.on('qr', () => {
		console.log(color('[', 'white'), color('!', 'red'), color(']', 'white'), color('Scan Qr!'))
		
	})

	// Menghubungkan
	fs.existsSync(`./${setting.sessionName}.json`) && agam.loadAuthInfo(`./${setting.sessionName}.json`)
	agam.on('connecting', () => {
		console.log(color('[ AGAM ]', 'cyan'), color('Connecting....'));
	})

	//connect
	agam.on('open', () => {
		console.log(color('[ AGAM ]', 'cyan'), color('Connected√!'));
	})

	// session
	await agam.connect({
		timeoutMs: 30 * 1000
	})
	fs.writeFileSync(`./${setting.sessionName}.json`, JSON.stringify(agam.base64EncodedAuthInfo(), null, '\t'))

	// Baterai
	agam.on('CB:action,,battery', json => {
		global.batteryLevelStr = json[2][0][1].value
		global.batterylevel = parseInt(batteryLevelStr)
		baterai = batterylevel
		if (json[2][0][1].live == 'true') charging = true
		if (json[2][0][1].live == 'false') charging = false
		console.log(json[2][0][1])
		console.log('Baterai : ' + batterylevel + '%')
	})
	global.batrei = global.batrei ? global.batrei : []
	agam.on('CB:action,,battery', json => {
		const batteryLevelStr = json[2][0][1].value
		const batterylevel = parseInt(batteryLevelStr)
		global.batrei.push(batterylevel)
	})

	// welcome
	agam.on('group-participants-update', async (anu) => {
		await welcome(agam, anu)
	})

	agam.on('chat-update', async (message) => {
		require('./agam.js')(agam, message)
	})
}

starts()
